<!DOCTYPE html>
<html class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>客户列表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8"/>
    <link rel="stylesheet" href="__CSS__/font.css">
    <link rel="stylesheet" href="__CSS__/xadmin.css">
    <script src="__LIB__/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="__JS__/xadmin.js"></script>
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="x-nav">
          <span class="layui-breadcrumb">
            <a href="">客户</a>
            <a>
              <cite>销售列表</cite></a>
          </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
</div>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">


                <div class="layui-card-body layui-table-body layui-table-main">
                    <form class="layui-form" action="">
                        <table class="layui-hide" id="table_data" lay-filter="table_data"></table>
                        <button class="layui-btn" lay-submit lay-filter="*">提交</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    layui.config({
        base: '__JS__/'
    }).extend({
        tableEdit: 'tableEdit',
        excel: 'excel',
    }).use(['table', 'tableEdit','excel'], function () {
        var tableEdit = layui.tableEdit;
        var table = layui.table, $ = layui.$,form = layui.form;
        var  params = [];
        $.ajax({
            url: "/admin/productData",
            type: 'get',
            dataType: 'json',
            sync: false,
            async:false, //同步请求
            success: function (resp) {
                var _resp = JSON.stringify(resp);
                params = JSON.parse(_resp);
            }
        })

        var cols = table.render({
            elem: '#table_data'
            ,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
            , id: 'table_data1'
            , url: 'getData'
            // , height: '500px'
            , page: false
            // , height: "100%"
            , cols: [
                [
                    {
                        rowspan: "1",
                        colspan: "7",
                        title: "广州恒辰电子有限公司",
                        align: "center"
                    },

                ],
                [
                    {
                        rowspan: "1",
                        colspan: "7",
                        title: "地址：广州是越秀区米市路45号  电话：202-83192063",
                        align: "center"
                    }
                ],[
                    {type:'numbers',title:"ID", unresize: true}
                    , {
                        field: 'product_name',
                        title: '产品名称',
                        width: 120,
                        rowspan: "3",
                        event: 'product_name',
                        config: {type: 'select', data: params, verify: false}
                        , templet: function (d) {

                            if (d.product_name.constructor === Object) {
                                return d.product_name.value;
                            }
                            return d.product_name
                        }
                    }
                    ,{field: 'price', title:'单价'}
                    ,{field: 'price', title:'单价'}
                    ,{field: 'price', title:'单价'}
                    ,{field: 'price', title:'单价'}
                    ,{field: 'price', title:'单价'}
                //
                // ,{
                //     field: 'customer_name',
                //     title: '客户名称',
                //     width: 120,
                //     rowspan: "3",
                //     event: 'customer_name',
                //     config: {type: 'select', data: params, verify: false}
                //     , templet: function (d) {
                //         // console.log(d);
                //         // if (d.customer_name.constructor === Object) {
                //         //     return d.customer_name.value;
                //         // }
                //         return d.customer_name
                //     }
                // }
                // ,{
                //     field: 'count',
                //     title: '数量',
                //     width: 120,
                //     event: 'count',
                //     rowspan: "3",
                //     config: {type: 'select', data: params, verify: false}
                //     , templet: function (d) {
                //         // console.log(d);
                //         // if (d.count.constructor === Object) {
                //         //     return d.count.value;
                //         // }
                //         return d.count
                //     }
                // }
            ]],
            done: function (res, curr, count) {
                // console.log(res);
                var exportData = layui.table.cache["table_data1"];
                // exportMe(exportData);
                console.log(exportData);
            }
        }).config.cols;
        //参数cols是table.render({})中的cols属性值
        var aopTable = tableEdit.aopObj(cols); //获取一个aop对象
        aopTable.on('tool(table_data)',function (obj) {

            var field = obj.field; //单元格字段
            var value = obj.value; //修改后的值
            var data = obj.data; //当前行旧数据
            var event = obj.event; //当前单元格事件属性值
            var update = {};
            update[field] = value;
            //把value更新到行中
            obj.update(update);
            /**
             *说白了，此obj与table.on('tool(tableEvent)',function (obj) {})
             *中的obj对象是同一个，所以可以如此操作。
             *
             * */
        });

        tableEdit.on('clickBefore(product_name)',function (obj) {
            var cascadeSelectData = obj.data; //级联数据
            console.log(obj);
            var cascadeSelectField = obj.field; //级联字段

        });

        form.on('submit(*)',function (data) {
            var data = layui.table.cache["table_data1"]

            $.ajax({
                url: "/admin/sale_list/explode",
                type: 'post',
                dataType: 'json',
                data: {data},
                sync: false,
                async:false, //false同步请求 true 异步
                success: function (resp) {
                    console.log(resp)
                }
            })
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
    });

</script>
</html>